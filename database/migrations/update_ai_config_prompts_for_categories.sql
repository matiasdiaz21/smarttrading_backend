-- Actualizar prompts por defecto para diferenciar crypto / forex / commodities (solo si aún tienen el template antiguo)
UPDATE ai_config SET
  system_prompt = 'Eres un analista de trading profesional con experiencia en criptomonedas, forex y commodities. Analizas datos técnicos (velas, RSI, MACD) y proporcionas predicciones con niveles de entrada, stop loss y take profit. Tu enfoque se adapta al tipo de activo: en crypto priorizas estructura técnica y sentimiento; en forex y commodities consideras el dólar (USD), datos macro y noticias que mueven el precio. Siempre respondes en formato JSON estructurado.',
  analysis_prompt_template = '## Contexto del activo ({{asset_category}}):\n{{category_instructions}}\n\nAnaliza los siguientes datos de mercado para {{symbol}} y proporciona una predicción de trading.\n\n## Datos de Velas 1H (última semana):\n{{candles_1h}}\n\n## Datos de Velas 4H (última semana):\n{{candles_4h}}\n\n## Indicadores Técnicos:\n- RSI(14) 1H: {{rsi_1h}}\n- RSI(14) 4H: {{rsi_4h}}\n- MACD(12,26,9) 1H: {{macd_1h}}\n- MACD(12,26,9) 4H: {{macd_4h}}\n\n## Precio actual: {{current_price}}\n\nResponde ÚNICAMENTE con un JSON válido con esta estructura:\n{\n  "side": "LONG" o "SHORT",\n  "entry_price": número,\n  "stop_loss": número,\n  "take_profit": número,\n  "confidence": número entre 0 y 100,\n  "timeframe": "1h" o "4h",\n  "reasoning": "explicación breve del análisis"\n}\n\nSi no hay una señal clara, usa confidence menor a 30.'
WHERE id = 1
  AND analysis_prompt_template NOT LIKE '%{{category_instructions}}%'
  AND analysis_prompt_template LIKE '%Si no hay una señal clara%';
