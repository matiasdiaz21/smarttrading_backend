-- Tabla de predicciones de la IA
CREATE TABLE IF NOT EXISTS ai_predictions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  asset_id INT NOT NULL,
  symbol VARCHAR(20) NOT NULL,
  side ENUM('LONG', 'SHORT') NOT NULL,
  timeframe ENUM('1h', '4h') NOT NULL DEFAULT '4h',
  entry_price DECIMAL(20, 8) NOT NULL,
  stop_loss DECIMAL(20, 8) NOT NULL,
  take_profit DECIMAL(20, 8) NOT NULL,
  confidence INT NOT NULL DEFAULT 50 COMMENT '0-100',
  reasoning TEXT DEFAULT NULL COMMENT 'Explicación de la IA',
  status ENUM('pending', 'active', 'won', 'lost', 'expired', 'cancelled') DEFAULT 'active',
  result_price DECIMAL(20, 8) DEFAULT NULL COMMENT 'Precio al que se resolvió',
  result_pnl_percent DECIMAL(10, 4) DEFAULT NULL COMMENT '% ganancia/pérdida',
  price_at_prediction DECIMAL(20, 8) DEFAULT NULL COMMENT 'Precio cuando se creó la predicción',
  expires_at DATETIME NOT NULL,
  resolved_at DATETIME DEFAULT NULL,
  resolved_by ENUM('auto', 'admin') DEFAULT NULL,
  groq_model VARCHAR(100) DEFAULT NULL,
  groq_tokens_used INT DEFAULT NULL,
  raw_ai_response TEXT DEFAULT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_status (status),
  INDEX idx_symbol (symbol),
  INDEX idx_asset (asset_id),
  INDEX idx_created (created_at),
  INDEX idx_expires (expires_at),
  FOREIGN KEY (asset_id) REFERENCES ai_assets(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
